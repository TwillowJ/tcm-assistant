# 🌿 中医智能小助手

一个基于AI的中医养生咨询应用，采用多轮对话形式，提供个性化的中医辨证分析和养生建议。

---

## 📋 笔试作业说明

> 本项目作为笔试作业提交，以下为要求的核心问题回答。

### 1️⃣ 产品设计思路：如何考虑用户需求和体验

**用户需求分析：**
- **健康咨询痛点**：用户对身体不适有疑虑，但未必需要立即就医，希望获得初步的养生建议
- **专业门槛高**：中医理论晦涩，普通用户难以自行辨证，需要通俗易懂的解释
- **隐私敏感性**：健康信息属于敏感隐私，用户可能不愿提供完整个人信息

**设计解决方案：**

1. **多轮对话设计**
   - 采用聊天式界面，降低使用门槛
   - AI可主动询问细节，逐步收集信息，而非要求用户一次性填写长表单
   - 支持连续追问，模拟真实中医问诊流程

2. **渐进式信息收集**
   - 核心功能：只需描述症状即可开始
   - 可选信息：年龄、性别等个人信息完全可选，折叠收起默认
   - 快速选择：提供6个常见症状按钮，降低输入成本

3. **即时反馈机制**
   - 发送消息后立即显示在聊天框
   - "正在分析中..."状态提示，减少等待焦虑
   - 流式输出（打字机效果），让用户感受到AI在"思考"，而非冰冷的一次性输出

4. **隐私优先设计**
   - 个人信息标注"可选"，降低用户心理负担
   - 未提供的信息不会被AI假设（如年龄选择"未提供"时，AI不会假设默认年龄）
   - 对话不永久存储，刷新即清空

5. **视觉体验优化**
   - 渐变色标题、卡片式布局，现代化设计语言
   - 按钮悬停动画、光标效果，提升交互趣味性
   - 固定高度聊天容器，避免页面过长导致的滚动困扰

6. **错误容忍设计**
   - 返回首页前弹出确认框，防止误操作丢失对话
   - "新对话"功能，支持快速重新开始
   - 异常处理友好，API错误时给出明确提示

**用户体验验证：**

通过迭代优化（v1.0 → v1.6.3），不断改进用户反馈的问题。

---

### 2️⃣ 技术选型理由

**Streamlit 作为前端框架：**
- ✅ **快速开发**：纯Python编写，无需HTML/CSS/JavaScript基础，适合快速原型验证
- ✅ **原生组件丰富**：`st.chat_message()`、`st.chat_input()` 等聊天组件开箱即用
- ✅ **Session State管理**：内置状态管理，轻松实现多轮对话历史保存
- ✅ **一键部署**：Streamlit Community Cloud 免费托管，GitHub推送即自动部署
- ⚠️ **权衡**：不适合大规模生产环境，但对演示和MVP极其友好

**OpenAI GPT-4o-mini 作为AI模型：**
- ✅ **成本效益**：相比GPT-4，mini版本成本降低90%，适合高频对话场景
- ✅ **响应速度**：推理速度快，支持流式输出，用户等待时间短
- ✅ **中文能力强**：对中医术语理解准确，能生成地道的中文养生建议
- ✅ **可控性好**：通过System Prompt精细调教，确保输出符合中医逻辑
- ⚠️ **权衡**：依赖第三方API，需处理网络异常和费用控制

**Python 作为开发语言：**
- ✅ **生态丰富**：OpenAI SDK、python-dotenv 等库成熟
- ✅ **开发效率高**：简洁语法，快速迭代
- ✅ **跨平台**：本地开发和云端部署无缝衔接

**其他技术选择：**
- **python-dotenv**：环境变量管理，安全存储API密钥
- **自定义CSS**：Streamlit默认样式单调，通过CSS注入实现UI美化
- **Git + GitHub**：版本控制和持续部署基础设施

**未选择的方案及原因：**
- ❌ **传统Web框架（Flask/Django）**：开发周期长，需前后端分离，不适合快速验证
- ❌ **GPT-4 完整版**：成本高，mini版本对本应用场景已足够
- ❌ **本地部署LLM**：资源消耗大，部署复杂，不适合演示项目

---

### 3️⃣ 快速学习心得：如何理解中医辨证并应用于Prompt设计

**学习路径：**

1. **理论学习（从基础概念入手）**
   - 研究中医基础理论：阴阳五行、气血津液、脏腑经络
   - 理解核心证型：气虚、血虚、阴虚、阳虚、气滞、血瘀、痰湿、湿热
   - 学习辨证方法：八纲辨证（表里寒热虚实）、脏腑辨证

2. **实践观察（从真实案例学习）**
   - 研究中医问诊流程：望闻问切的逻辑
   - 分析症状与证型的对应关系：如"疲劳乏力 + 消化不良 → 脾气虚"
   - 观察养生建议结构：饮食、起居、运动、穴位

3. **Prompt工程应用（从抽象到具体）**

**第一层：角色定义（建立专业人设）**
```
你是一位经验丰富的中医养生专家，拥有深厚的中医理论功底和丰富的临床经验。
精通：阴阳五行、藏象学说、经络学说、病因病机...
```
- **作用**：让AI进入"中医专家"角色，输出风格更专业

**第二层：输出结构（确保回答完整性）**
```
**中医辨证分析：**
1. 证型判断：明确指出1-2个最可能的证型
2. 辨证依据：详细说明为什么判断为该证型
3. 病机解释：用通俗易懂的语言解释
4. 个体因素：考虑年龄、性别对症状的影响

**养生建议：**
1. 饮食调理：推荐食物5-8种、食疗方2-3个...
2. 生活起居：作息建议、睡眠改善3-5个方法...
3. 运动养生：推荐运动3-5种...
4. 其他调理：穴位保健3-5个...
```
- **作用**：强制AI按固定格式输出，避免遗漏关键内容

**第三层：细节量化（提升建议可操作性）**
```
- 推荐食物：列举5-8种具体食物，说明功效和食用方法
- 食疗方：提供2-3个简单易做的食疗方，标注材料用量和详细做法
- 运动方案：具体的频率（每周几次）、时长、强度、最佳时间
```
- **作用**：避免空泛建议（如"多运动"），给出具体数量和方法

**第四层：安全边界（防止医疗风险）**
```
重要原则：
✓ 本建议仅供养生保健参考，不能替代专业医疗诊断和治疗
✓ 遇到急性重症、持续恶化，必须明确建议就医
✓ 不推荐具体中药方剂，重点在食疗和生活方式调整
```
- **作用**：确保AI不越界，避免误导用户

**第五层：隐私处理（动态调整策略）**
```python
# 年龄信息处理
if age == "未提供":
    age_info = "未提供（请勿在回复中假设或提及具体年龄）"
else:
    age_info = f"{age}岁"
```
- **作用**：未提供的信息不会被AI假设，保护用户隐私

**关键心得：**
- 🎯 **结构化 > 自由发挥**：明确的Prompt结构能确保输出质量一致性
- 📊 **量化细节 > 模糊描述**：要求"5-8种食物"比"一些食物"更可控
- 🔒 **安全边界 > 功能完整**：宁可保守也不能误导用户就医
- 🧪 **迭代优化 > 一次到位**：通过v1.0到v1.6的迭代，不断完善Prompt

**实际应用示例：**
初版Prompt问题：AI回答太简短，缺少具体食物名称
```
优化前：建议：多吃健脾的食物
优化后：推荐食物：山药（健脾益气）、小米（养胃安神）、红枣（补中益气）
        每日建议：山药粥（早餐），红枣5-8颗（零食）
```
通过在Prompt中要求"列举5-8种具体食物，说明功效和食用方法"解决。

以下为常规项目说明内容。

---

## ✨ 核心特性

- 🤖 **AI智能分析**：基于 OpenAI GPT-4o-mini 模型，提供专业的中医辨证分析
- 💬 **多轮对话**：支持连续对话，AI可以主动询问细节，提供更精准的建议
- ⚡ **流式输出**：AI回复实时流式显示，打字机效果，提升用户体验
- 🎯 **精准辨证**：从中医角度分析证型（气虚、血虚、阴虚、阳虚、气滞、血瘀等）
- 💊 **实用养生建议**：饮食调理、生活起居、运动养生、穴位保健等全方位指导
- 🔒 **隐私保护**：个人信息完全可选，未提供的信息不会被AI假设
- 🎨 **精美界面**：渐变卡片设计，按钮悬停动画，现代化UI

## 🚀 在线演示

**部署链接**：https://tcm-assistant-faqih5eesu2aadpazfgnfg.streamlit.app/

## 📱 功能展示

### 欢迎页面
- 渐变色标题设计
- 卡片式功能展示（AI智能分析、精准辨证、养生建议、隐私保护）
- 简洁的免责声明
- 一键进入问诊

### 对话界面
- **固定高度聊天容器**：500px高度，内部可滚动，避免页面过长
- **智能欢迎语**：首次进入显示AI助手的自我介绍
- **快速症状选择**：6个常见症状按钮（2列布局，移动端友好）
  - 😴 疲劳乏力、精神不振
  - 🌙 失眠多梦、睡眠质量差
  - 🍽️ 消化不良、胃胀腹胀
  - 🤕 头痛头晕
  - 😰 焦虑心烦、情绪低落
  - 🦴 腰酸背痛、关节疼痛
- **个人信息（可选）**：
  - 年龄：下拉选择1-120岁或"未提供"
  - 性别：不方便透露/男/女
  - 提示：*提供个人信息可获得更精准的养生建议*
- **实时流式回复**：
  - 发送消息后立即显示在聊天框
  - 显示"正在分析中..."状态
  - AI回复在聊天框内逐字流式显示，带光标效果 ▌
- **对话管理**：
  - 返回首页（有对话时需确认）
  - 新对话（清空历史重新开始）

### AI分析内容结构
当用户描述症状后，AI会提供：

**中医辨证分析：**
1. 证型判断及依据
2. 病机解释（通俗易懂）
3. 个体因素分析（考虑年龄、性别影响）

**养生建议：**
1. **饮食调理**：推荐食物5-8种、食疗方2-3个、避免食物、饮食习惯
2. **生活起居**：作息建议、睡眠改善3-5个方法、情绪调节、日常注意
3. **运动养生**：推荐运动3-5种、运动方案（频率/时长/强度）、传统功法、运动禁忌
4. **其他调理**：穴位保健3-5个、外治方法、季节调养、日常小妙招

**重要提醒：**
1. 就医建议（哪些症状需及时就医）
2. 调理周期（预期多久见效）
3. 注意事项（基础疾病/服药提醒）
4. 跟踪评估方法

## 🛠️ 技术栈

- **前端框架**：Streamlit 1.40+
- **AI模型**：OpenAI GPT-4o-mini
- **编程语言**：Python 3.8+
- **部署平台**：Streamlit Community Cloud
- **样式设计**：自定义CSS（渐变背景、悬停动画、圆角优化）

## 📦 项目结构

```
medical/
├── app.py                          # Streamlit主应用（多轮对话界面）
├── llm_service.py                  # LLM服务（OpenAI API封装）
├── requirements.txt                # Python依赖包
├── .env                           # 环境变量（本地开发）
├── .gitignore                     # Git忽略配置
└── README.md                      # 项目文档
```

## 🔧 本地开发

### 前置要求
- Python 3.8+
- OpenAI API Key

### 快速开始

1. **克隆仓库**
```bash
git clone https://github.com/TwillowJ/tcm-assistant.git
cd tcm-assistant
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **配置API密钥**

创建 `.env` 文件：
```bash
echo "OPENAI_API_KEY=your_api_key_here" > .env
```

4. **运行应用**
```bash
streamlit run app.py
```

应用将在 `http://localhost:8501` 自动打开。

## 🌐 部署到Streamlit Cloud

### 部署步骤

1. **推送代码到GitHub**
```bash
git add .
git commit -m "你的提交信息"
git push
```

2. **访问 Streamlit Cloud**
   - 登录 [share.streamlit.io](https://share.streamlit.io)
   - 点击 "New app"

3. **配置应用**
   - Repository: 选择你的GitHub仓库
   - Branch: main
   - Main file path: `app.py`

4. **添加Secrets**
   在Streamlit Cloud的应用设置中，添加：
```toml
OPENAI_API_KEY = "your_openai_api_key_here"
```

5. **部署完成**
   - 等待1-2分钟自动部署
   - 获得公开访问链接

### 自动更新
推送代码到GitHub后，Streamlit Cloud会自动检测并重新部署：
```bash
git add .
git commit -m "更新说明"
git push
```

## 📝 使用说明

### 基本流程
1. 访问应用网址
2. 点击"🩺 开始问诊"进入对话
3. 可选：展开"个人信息"填写年龄和性别
4. 描述症状（可选快速选择或手动输入）
5. AI实时流式返回分析和建议
6. 可继续追问或询问更多细节

### 示例对话

**用户**：最近经常感到疲劳乏力，下午特别明显，晚上睡眠质量也不好

**AI**：理解您的情况。为了更准确地分析，我想了解几个细节：
1. 这种疲劳感持续多久了？
2. 是否伴有其他症状，比如食欲、消化方面的问题？

**用户**：持续大约两周了，胃口一般，有时会腹胀

**AI**：[提供完整的中医辨证分析和养生建议]
- 证型判断：脾气虚弱...
- 饮食调理：山药、小米、红枣...
- 生活起居：...
- 运动养生：...
- [更多详细建议]

### 隐私保护说明
- **个人信息完全可选**：不填写也能获得建议
- **未提供的信息不会被假设**：选择"未提供"年龄时，AI不会假设具体年龄
- **对话不会永久存储**：刷新页面后对话清空
- **仅本地session保存**：数据仅在当前会话中存在

## ⚠️ 免责声明

**本应用仅为 AI 技术演示，内容仅供参考，不能替代专业医疗诊断。**

- 本应用基于AI大语言模型，可能存在不准确或不完整之处
- 建议仅为养生保健参考，不涉及具体诊断和药物治疗
- 如有严重、持续或恶化的症状，请及时就医
- 如有基础疾病或正在服药，请咨询专业医师后再采纳建议

## 📊 版本历史

### v1.6.3 (2025-10-19) - 当前版本
- 🔧 **重要修复**：修复年龄信息传递问题，未提供年龄时AI不再假设默认值
- ✨ 优化个人信息输入方式，年龄改为下拉选择框
- 🎨 UI/UX优化：渐变标题、卡片式布局、按钮悬停动画

### v1.6.2 (2025-10-19)
- 🎨 优化个人信息输入方式，移除复选框，简化操作流程
- ✨ 年龄输入改为下拉选择框，与性别框样式一致

### v1.6.1 (2025-10-19)
- 🔧 修复个人信息默认值问题，添加"提供年龄信息"复选框

### v1.6 (2025-10-18)
- ✨ 流式输出优化：AI回复在聊天框内实时显示
- 🎨 欢迎页面：渐变色标题、卡片式功能展示
- 📱 响应式优化：快速症状选择改为2列布局
- 🎭 添加打字机效果和光标动画

### v1.5 (2025-10-18)
- 💬 实现多轮对话功能
- ⚡ 即时消息显示 + "正在分析中..."状态
- 📝 增强AI prompt，提供更详细的养生建议

### v1.0.0 (2025-10-17)
- 🎉 初始版本发布
- 🤖 集成OpenAI GPT-4o-mini模型
- 💊 实现中医辨证分析和养生建议
- 🚀 部署到Streamlit Community Cloud

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发方向建议
- 🎯 优化Prompt工程，提升分析准确性
- 📚 添加中医养生知识库
- 🌍 支持多语言（英文、繁体中文等）
- 📊 添加用户反馈和评分机制
- 🔍 实现症状搜索和历史记录
- 🎨 移动端UI优化

### 提交规范
```bash
# 功能开发
git commit -m "feat: 添加XXX功能"

# Bug修复
git commit -m "fix: 修复XXX问题"

# UI优化
git commit -m "style: 优化XXX界面"

# 文档更新
git commit -m "docs: 更新XXX文档"
```

## 📄 开源协议

本项目采用 MIT 协议开源，详见 [LICENSE](LICENSE) 文件。

## 🙏 致谢

- [Streamlit](https://streamlit.io/) - 优秀的Python Web应用框架
- [OpenAI](https://openai.com/) - 强大的GPT模型支持
- [Claude Code](https://claude.com/claude-code) - AI辅助开发工具
- 传统中医理论 - 为本应用提供理论基础

## 📧 联系方式

- **GitHub Issues**: [提交问题或建议](https://github.com/TwillowJ/tcm-assistant/issues)
- **项目仓库**: https://github.com/TwillowJ/tcm-assistant

---

**⭐ 如果这个项目对你有帮助，欢迎给个 Star！**

*本项目由 Claude Code 辅助开发完成*